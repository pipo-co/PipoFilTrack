<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1">
    <link rel="icon" href="/static/images/favicon.png" type="image/x-icon"/>
    <title>Filament Tracking</title>
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
          integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
	<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/filament_tracking.css">
</head>
<body>
	{% if filename %}
		<div class="left blur">
			<a class="logo" href="/">
				<div class="float-left">Filament tracking</div>
				<div class="green float-left">.</div>
			</a>
			<div class="center-left" style="width: 90%">
				<h2 class="mt-3 ml-5 mr-5">Seleccione el punto inicial y final del filamento que quiere trackear</h2>
				<h4 class="mt-3 ml-5 mr-5">Por favor modifique el tamaño del punto con los botones + y - para que sea acorde al grosor del filamento</h4>
			</div>
		</div>
		<div class="right">
			<div class="center-v blur">
				<div id="section_tracking_form" style="height: 100%">
					<div class="container" style="height: 85%">
						<div class="row" style="height: 100%">
							<div class="col-1 p-0">
								<div class="container p-0">
									<div class="row p-0">
										<div class="col p-0">
											<span id="plus" title="Increase dot size"><img class="mt-3" src="/static/images/plus.png" alt="plus"></span>
										</div>
									</div>
									<div class="row p-0">
										<div class="col p-0">
											<span id="minus" title="Decrease dot size"><img class="mt-3" src="/static/images/minus.png" alt="minus"></span>
										</div>
									</div>
									<div class="row p-0">
										<div class="col p-0">
											<span id="undo" title="Undo"><img class="mt-3" src="/static/images/undo.png" alt="undo"></span>
										</div>
									</div>
									<div class="row p-0">
										<div class="col p-0">
											<span id="redo" title="Redo"><img class="mt-4" src="/static/images/redo.png" alt="redo"></span>
										</div>
									</div>
									<div class="row p-0">
										<div class="col p-0">
											<label class="mt-4">
												Filtro
												<input id="toggle_filter" type="checkbox" data-toggle="toggle" data-onstyle="success">
											</label>
										</div>
									</div>
								</div>
							</div>
							<div class="col-10 p-0">
								<canvas id="canvas" class="mt-3 mr-2 ml-2 mb-2" style="background:url({{ filename }});"></canvas>
							</div>
							<div class="col-1 p-0"></div>
						</div>
					</div>

					<div class="container" style="height: 15%">
						<div class="row">
							<div class="col-1 p-0"></div>
							<div class="col-5 p-0">
								<a href="/">
									<button class="button mb-1 mt-2 ml-0 mr-0" type="submit">Reset</button>
								</a>
							</div>
							<div class="col-5 p-0">
								<form id="tracking_form" method="post" action="/track" enctype="application/json">
									<input type="hidden" name="points" id="points">
									<input type="hidden" name="canvas_size" id="canvas_size">
									<input type="hidden" name="filename" value="{{ filename }}">
									<input type="hidden" name="point_size" value="">
									<button id="submit_tracking_form" class="button mb-1 mt-2 ml-0 mr-0" type="submit">Start</button>
								</form>
							</div>
							<div class="col-1 p-0"></div>
						</div>
					</div>
					{% with messages = get_flashed_messages() %}
						{% if messages %}
							<div class="flashes mt-2">
								{% for message in messages %}
								<p>{{ message }}</p>
								{% endfor %}
							</div>
						{% endif %}
					{% endwith %}
				</div>
			</div>
		</div>
	{% else %}
		<div class="left blur">
			<a class="logo" href="/">
				<div class="float-left">Filament tracking</div>
				<div class="green float-left">.</div>
			</a>
			<div class="center-left" style="width: 90%">
				<h3 class="subtitle mt-5">Proyecto Final ITBA</h3>
				<h1>Análisis de imágenes de microscopía de fluorescencia para segmentación y tracking de estructuras biológicas</h1>
			</div>
		</div>
		<div class="right">
			<div class="center-v2 blur">
				<div id="track">
					<h4 class="m-5">Seleccione las imágenes que desea trackear</h4>
					<form method="post" action="/" enctype="multipart/form-data" class="container">
						<div class="row m-5">
							<div class="col">
								<input onchange="form.submit()" type="file" name="files[]" accept=".tif,.tiff,.avi,.jpg,.jpeg" multiple required/>
							</div>
						</div>
						{% with messages = get_flashed_messages() %}
							{% if messages %}
								<div class="flashes mt-2">
									{% for message in messages %}
									<p>{{ message }}</p>
									{% endfor %}
								</div>
							{% endif %}
						{% endwith %}
					</form>
				</div>
			</div>
		</div>
	{% endif %}

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
	<script src="/static/js/filament_tracking.js"></script>
</body>
</html>